### 问题
  最近老婆给女儿买了一个闹钟，早上吃饭的时候女儿都在玩，可是她不会调时间，于是让我来帮忙，我调着调着就想到一个问题：计算机的时间是怎么工作的？为什么电脑关机了再打开，时间是正确的，而不是关机时的时刻？

### 联想
  1. 墙上的时钟没电了 时间就停了
  1. 闹钟没电了 时间也停了
  1. 手表没电了 时间同样停了

所以电脑虽然关机了，但是时间系统并没有停电，那么这个时间系统是什么呢？

### 真相
计算机主板上面有时钟芯片和电池用于计算机关机断电以后保持时钟正常计时用，另外计算机的操作系统，不管是windows，linux或是mac os还是别的什么系统（主流的版本），正常工作的时候都会自动的与网络上的时间服务器进行同步对时，保证时间的准确。

有单独的晶振，单独的计数器，单独的电池供电保证不间断计时。

首先有个时钟分频器记录晶振波形上升沿个数，晶振波形上升沿的频率是固定的，就可以通过一共有多少个上升沿判断时间了。这个单独的晶振频率一般为32768Hz，即每出现32768个上升沿就过去了1秒。时钟分频器会每秒输出一次记时信号给计数器。

计数器中的数值会根据分频器输出的记时信号每秒加1，这个数值就是从1970年1月1日0点0分0秒到当时那个时间之间的秒数，如果这个数值是31，536，000就代表1971年1月1日0点0分0秒。软件获得这个计数器中的数字就可以计算出当时的时间了。

### 时钟芯片
RTC（Real time clock）芯片，作为通过电源或电池供电的芯片，会产生固定频率的脉冲，基于这样的一个假设，可以编制在BIOS上运行的程序，通过计算脉冲数量来来计时；一台完全离线的主机，可以通过设定BIOS的时间，使得间隔足够长的时间，仍能够稳定地报告最新的时间。

### RTC Real-Time Clock(实时时钟的简称）
实时时钟（Real-Time Clock）是PC主板上的晶振及相关电路组成的时钟电路的生成脉冲，提供稳定的时钟信号给后续电路用。主要功能有:时钟，日历，闹钟，周期性中断输出，32KHz时钟输出。

RTC 是集成电路，通常称为时钟芯片。

实时时钟芯片是日常生活中应用最为广泛的消费类电子产品之一。它为人们提供精确的实时时间，或者为电子系统提供精确的时间基准，目前实时时钟芯片大多采用精度较高的晶体振荡器作为时钟源。有些时钟芯片为了在主电源掉电时，还可以工作，需要外加电池供电。

### RTC发展历史
1. 早期RTC产品
>早期RTC产品实质是一个带有计算机通讯口的分频器。它通过对晶振所产生的振荡频率分频和累加，得到年、月、日、时、分、秒等时间信息并通过计算机通讯口送入处理器处理。
这一时期RTC的特征如下：在控制口线上为并行口；功耗较大；采用普通CMOS工艺；封装为双列直插式；芯片普遍没有现代RTC所具有的万年历及闰年月自动切换功能，也无法处理2000年问题。现在已经被淘汰。
2. 中期RTC产品
>在20世纪90年代中期出现了新一代RTC，它采用特殊CMOS工艺；功耗大为降低，典型值约0。5μA以下；供电电压仅为1。4V以下；和计算机通讯口也变为串行方式，出现了诸如三线SIO/四线SPI，部分产品采用2线I2C总线；包封上采用SOP/SSOP封装，体积大为缩小；
功能上：片内智能化程度大幅提高、具有万年历功能，输出控制也变得灵活多样。其中日本RICOH推出的RTC甚至已经出现时基软件调校功能（TTF）及振荡器停振自动检测功能而且芯片的价格极为低廉。目前，这些芯片已被客户大量使用中。
3. 最新一代RTC产品
>最新一代RTC产品中，除了包含第二代产品所具有的全部功能，更加入了复合功能，如低电压检测，主备用电池切换功能，抗印制板漏电功能，且本身封装更小（高度0。85mm，面积仅为2mm*2mm）。

### RTC硬件结构
1. 晶振
>晶振一般叫做晶体谐振器，是一种机电器件，晶振是石英振荡器的简称，英文名为Crystal是用电损耗很小的石英晶体经精密切割磨削并镀上电极焊上引线做成。
晶振的作用：提供基准频率。
2. RTC的晶振
>任何实时时钟的核心都是晶振，晶振频率为32768 Hz 。它为分频计数器提供精确的与低功耗的实基信号。它可以用于产生秒、分、时、日等信息。为了确保时钟长期的准确性，晶振必须正常工作，不能够收到干扰。RTC的晶振又分为：外部晶振和内置晶振。
3. RTC的晶振频率为什么是32768Hz？
> *  RTC时间是以振荡频率来计算的。故它不是一个时间器而是一个计数器。而一般的计数器都是16位的。又因为时间的准确性很重要，故震荡次数越低，时间的准确性越低。所以必定是个高次数。215 = 32768 。
> *  32768 Hz = 215 即分频15次后为1Hz，周期 = 1s。
> *  经过工程师的经验总结32768 Hz，时钟最准确。
> *  规范和统一。


### RTC总线接口
常用的时钟芯片分为并行接口和串行接口两大类(并行时钟芯片数据传送速率较快，连线多，不利于缩小产品体积，且占用较多的CPU端口资源。串行时钟芯片只需占用CPU的2-3条I/O口线，可大大减小产品体积线接口。


### RTC时钟误差
实时时钟芯片的时间误差主要来源于时钟芯片中晶振的频率误差，而晶振的频率误差主要是由于温度变化引起的。所以把温度对晶振谐振频率所产生的误差进行有效的补偿，是提高时钟精度的关键。石英晶体谐振频率误差补偿方法，是在晶振谐振频率随着温度的变化存在误差已知的基础上， 对产生1Hz频率的分频计数器进行精确补偿的方法。

RTC最重要的功能是提供到2099年内的日历功能，对于时间来说，无论快慢都是误差，而匹配电容在RTC的外围器件上起到非常重要的作用，它可以适当修正晶体与RTC之间匹配问题。